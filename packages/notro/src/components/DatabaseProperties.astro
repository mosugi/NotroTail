---
import type { PageObjectResponse } from "@notionhq/client/build/src/api-endpoints";
import options from "virtual:notro-options";
import DatabaseProperty from "./DatabaseProperty.astro";
import { Page } from "../utils/notion/utils";

interface Props {
  page: Page;
}

const { page } = Astro.props;

const filteredProperties: [string, PageObjectResponse["properties"][1]][] =
  Object.entries(page.properties)
    .filter(([key]) => {
      return (
        options.visibleChildDatabaseProperties.length === 0 ||
        options.visibleChildDatabaseProperties.includes(key)
      );
    })
    .sort(([keyA], [keyB]) => {
      const indexA = options.visibleChildDatabaseProperties.indexOf(keyA);
      const indexB = options.visibleChildDatabaseProperties.indexOf(keyB);

      return indexA - indexB;
    });
---

<div class="notion-table-view-row">
  {
    filteredProperties?.map(([key, value]) => {
      return (
        <div class="notion-table-view-cell">
          <DatabaseProperty name={key} property={value} page={page} />
        </div>
      );
    })
  }
</div>
