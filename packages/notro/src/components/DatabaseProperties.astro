---
import type { PageObjectResponse } from "@notionhq/client/build/src/api-endpoints";
import options from "virtual:notro-options";
import DatabaseProperty from "./DatabaseProperty.astro";

const { properties } = Astro.props as PageObjectResponse["properties"];

const filteredProperties: [string, PageObjectResponse["properties"][1]][] =
  Object.entries(properties)
    .filter(([key]) => {
      return (
        options.visibleChildDatabaseProperties.length === 0 ||
        options.visibleChildDatabaseProperties.includes(key)
      );
    })
    .sort(([keyA], [keyB]) => {
      const indexA = options.visibleChildDatabaseProperties.indexOf(keyA);
      const indexB = options.visibleChildDatabaseProperties.indexOf(keyB);

      return indexA - indexB;
    });
---

<div class="notion-table-view-row">
  {
    filteredProperties?.map(([key, value]) => {
      return (
        <div class="notion-table-view-cell">
          <DatabaseProperty name={key} property={value} />
        </div>
      );
    })
  }
</div>
